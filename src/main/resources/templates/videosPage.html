<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Videos page</title>
    <style>
        body {
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }

        .dashboard {
            background-color: #5e057e;
            color: #fff;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
        }

        .dashboard__title {
            font-size: 24px;
            margin-top: 0;
        }

        .dashboard__user {
            margin-top: 20px;
        }

        .dashboard__user-name {
            font-size: 50px;
            color: #c299d0;
        }

        .navigation {
            background-color: #5e057e;
            color: #fff;
            padding: 10px 0;
            text-align: center;
            margin-top: 20px;
        }

        .navigation__link {
            color: #fff;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-right: 10px;
            cursor: pointer;
        }

        .navigation__link:hover {
            background-color: #4b036a;
        }

        .video-info {
            background-color: #eee;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .video-info__title {
            font-size: 24px;
            margin-top: 0;
        }

        .video-info__description {
            font-size: 16px;
            color: #555;
        }

        .video-player {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #000;
            margin-bottom: 20px;
        }

        .video-player video {
            width: 100%;
            height: auto;
        }

        .share-button {
            background-color: #5e057e;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }

        .share-button:hover {
            background-color: #4b036a;
        }

        .video-navigation {
            padding: 20px;
            text-align: center;
        }

        .video-navigation__button {
            background-color: #fff;
            color: #5e057e;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }

        .video-navigation__button:last-child {
            margin-right: 0;
        }

        .video-navigation__button:hover {
            background-color: #c299d0;
            color: #fff;
        }
    </style>
</head>

<body>

<div class="dashboard">
    <h1 class="dashboard__title">Welcome to the Dashboard</h1>
    <div class="dashboard__user">
        <h2 th:text="${userdetail.firstName}" class="dashboard__user-name">User's Name</h2>
    </div>
</div>

<div class="navigation">
    <a th:href="@{/home}" class="navigation__link">HomePage</a>
    <a th:href="@{/upload}" class="navigation__link">Upload Video</a>
    <button class="share-button">Share</button>
    <span sec:authorize="isAuthenticated"><a th:href="@{/logout}" class="navigation__link">Logout</a></span>
</div>

<!-- Display the video details -->
<div class="video-info">
    <h2 class="video-info__title" ></h2>
    <p class="video-info__description"></p>
</div>


 Display the video player
<div class="video-player">
    <video id="mainVideoPlayer" controls>

        Your browser does not support the video tag.
    </video>
</div>


<!-- Video navigation buttons -->
<div class="video-navigation">
    <h2>Video Navigation</h2>
    <button class="video-navigation__button" onclick="previousVideo()">Previous Video</button>
    <button class="video-navigation__button" onclick="nextVideo()">Next Video</button>
</div>

<script>

    //Share button
  function copyVideoLink() {
    let currentVideo = availableVideos[currentIndex];
    let videoLink = window.location.origin + '/video/' + currentVideo.id + '/play';

    navigator.clipboard.writeText(videoLink).then(function () {
        alert('Video link copied to clipboard!');
    }, function() {
        alert('Failed to copy video link.');
    });
}

    // Attach the event listener to the share button
    document.querySelector('.share-button').addEventListener('click', copyVideoLink);



    let currentIndex = 0;
    let availableVideos = [];

    // Function to fetch and store videos once
    function fetchVideos() {
        fetch('/api/v1/videos') // Adjust if your API endpoint is different
            .then(response => response.json())
            .then(data => {
                availableVideos = data;
            })
            .catch(error => console.error("Error fetching videos:", error));
    }

    function nextVideo() {
        if (availableVideos.length === 0) {
            fetchVideos();
            return;
        }

        currentIndex = (currentIndex + 1) % availableVideos.length;
        let nextVideo = availableVideos[currentIndex];

        document.querySelector('.video-info__title').textContent = nextVideo.title;
        document.querySelector('.video-info__description').textContent = nextVideo.description;

        let videoPlayer = document.getElementById('mainVideoPlayer');
        videoPlayer.src = `/video/${nextVideo.id}/play`;
        videoPlayer.load();
    }

    function previousVideo() {
        currentIndex = (currentIndex - 1 + availableVideos.length) % availableVideos.length;
        let previousVideo = availableVideos[currentIndex];

         // Update video title and description (same logic as in nextVideo)
        document.querySelector('.video-info__title').textContent = previousVideo.title;
        document.querySelector('.video-info__description').textContent = previousVideo.description;

        // Update video source
        let videoPlayer = document.getElementById('mainVideoPlayer');
        videoPlayer.src = `/video/${previousVideo.id}/play`;
        videoPlayer.load();
    }

    (function() {
        // Initial setup
        fetchVideos();
    })();
</script>



</body>
</html>
