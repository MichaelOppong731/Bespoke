<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Videos page</title>
    <style>
        body {
            background-color: #f5f5f5;
            margin: 0;
            padding: 0;
        }

        .dashboard {
            background-color: #5e057e;
            color: #fff;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
        }

        .dashboard__title {
            font-size: 24px;
            margin-top: 0;
        }

        .dashboard__user {
            margin-top: 20px;
        }

        .dashboard__user-name {
            font-size: 50px;
            color: #c299d0;
        }

        .navigation {
            background-color: #5e057e;
            color: #fff;
            padding: 10px 0;
            text-align: center;
            margin-top: 20px;
        }

        .navigation__link {
            color: #fff;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin-right: 10px;
            cursor: pointer;
        }

        .navigation__link:hover {
            background-color: #4b036a;
        }

        .video-info {
            background-color: #eee;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .video-info__title {
            font-size: 24px;
            margin-top: 0;
        }

        .video-info__description {
            font-size: 16px;
            color: #555;
        }

        .video-player {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background-color: #000;
            margin-bottom: 20px;
        }

        .video-player video {
            width: 100%;
            height: auto;
        }

        .share-button {
            background-color: #5e057e;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }

        .share-button:hover {
            background-color: #4b036a;
        }

        .video-navigation {
            display: flex;
            justify-content: center;
            padding: 20px;
        }


        .video-navigation__button {
            background-color: #fff;
            color: #5e057e;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }

        .video-navigation__button:last-child {
            margin-right: 0;
        }

        .video-navigation__button:hover {
            background-color: #4b036a;
            color: #fff;
        }
    </style>
</head>

<body>

<div class="dashboard">
    <h1 class="dashboard__title">Welcome to the Dashboard</h1>
    <div class="dashboard__user">
        <h2 th:text="${userdetail.firstName}" class="dashboard__user-name">User's Name</h2>
    </div>
</div>

<div class="navigation">
    <a th:href="@{/home}" class="navigation__link">HomePage</a>
    <a th:href="@{/upload}" class="navigation__link">Upload Video</a>
    <button class="share-button">Share</button>
    <span sec:authorize="isAuthenticated"><a th:href="@{/logout}" class="navigation__link">Logout</a></span>
</div>

<!-- Display the video details -->
<div class="video-info">
    <h2 class="video-info__title" ></h2>
    <p class="video-info__description"></p>
</div>


<!-- Display the video player-->
<div class="video-player">
    <video id="mainVideoPlayer" controls>

        Your browser does not support the video tag.
    </video>
</div>


<!-- Video navigation buttons -->
<div class="video-navigation">
<!--    <h2 class="navigate_video">Video Navigation</h2>-->
    <button class="video-navigation__button" onclick="previousVideo()">Previous Video</button>
    <button class="video-navigation__button" onclick="nextVideo()">Next Video</button>
</div>

<script>

    //Share button
  function copyVideoLink() {
    let currentVideo = availableVideos[currentIndex];
    let videoLink = window.location.origin + '/video/' + currentVideo.id + '/play';

    navigator.clipboard.writeText(videoLink).then(function () {
        alert('Video link copied to clipboard!');
    }, function() {
        alert('Failed to copy video link.');
    });
}

    // Attaching the event listener to the share button
    document.querySelector('.share-button').addEventListener('click', copyVideoLink);



    let currentIndex = 0;
    let availableVideos = [];

    // Function to fetch and store videos once
    function fetchVideos() {
        return fetch('/api/v1/videos')
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch videos');
            }
            return response.json();
        })
        .then(data => {
            availableVideos = data;
        })
        .catch(error => {
            console.error("Error fetching videos:", error);
            throw error; // Re-throw the error to be caught by the caller
        });
    }

    function nextVideo() {
        if (availableVideos.length === 0) {
            fetchVideos();
            return;
        }

        currentIndex = (currentIndex + 1) % availableVideos.length;
        let nextVideo = availableVideos[currentIndex];

        document.querySelector('.video-info__title').textContent = nextVideo.title;
        document.querySelector('.video-info__description').textContent = nextVideo.description;

        let videoPlayer = document.getElementById('mainVideoPlayer');
        videoPlayer.src = `/video/${nextVideo.id}/play`;
        videoPlayer.load();
        updateButtonVisibility();
    }
    // function for previous button
    function previousVideo() {
        if (currentIndex === 0) {
            return; // Do nothing if on the first video
        }

        currentIndex = (currentIndex - 1) % availableVideos.length;
        let previousVideo = availableVideos[currentIndex];

        document.querySelector('.video-info__title').textContent = previousVideo.title;
        document.querySelector('.video-info__description').textContent = previousVideo.description;

        let videoPlayer = document.getElementById('mainVideoPlayer');
        videoPlayer.src = `/video/${previousVideo.id}/play`;
        videoPlayer.load();
        updateButtonVisibility();
    }

    // Helper function to update video details and player
    function updateVideoDisplay() {
        const videoInfoTitle = document.querySelector('.video-info__title');
        const videoInfoDescription = document.querySelector('.video-info__description');
        const videoPlayer = document.getElementById('mainVideoPlayer');

        if (availableVideos.length > 0) {
            const currentVideo = availableVideos[currentIndex];
            videoInfoTitle.textContent = currentVideo.title;
            videoInfoDescription.textContent = currentVideo.description;
            videoPlayer.src = `/video/${currentVideo.id}/play`;
            videoPlayer.load();
            videoPlayer.style.display = 'block';
        } else {
            // No videos available, display message
            videoInfoTitle.textContent = "No videos available.";
            videoInfoDescription.textContent = "";
            videoPlayer.style.display = 'none';
        }

        // Always update button visibility
        updateButtonVisibility();
    }


        // Function to control button visibility
    function updateButtonVisibility() {
        let nextButton = document.querySelector('.video-navigation__button:last-child');
        let prevButton = document.querySelector('.video-navigation__button:first-child');

        if (availableVideos.length === 0) {
            // Hide both buttons if no videos are available
            nextButton.style.display = 'none';
            prevButton.style.display = 'none';
        } else {
            // Show both buttons if videos are available
            nextButton.style.display = (currentIndex === availableVideos.length - 1) ? 'none' : 'block';
            prevButton.style.display = (currentIndex === 0) ? 'none' : 'block';
        }
    }



    (function() {
        function displayFirstVideo() {
            fetchVideos().then(() => {
                if (availableVideos.length > 0) {
                    currentIndex = 0;
                    updateVideoDisplay();
                    updateButtonVisibility();
                }
            }).catch(error => {
                console.error("Failed to fetch videos:", error);
                // Handle error, e.g., display an error message to the user
            });
        }
        displayFirstVideo();
    })();

     // Add the event listener for when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        displayFirstVideo();
    });
</script>



</body>
</html>